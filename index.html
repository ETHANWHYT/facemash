<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Facemash — Daily Face-off</title>
<style>
  :root{--bg:#f5f6fa;--card:#fff;--accent:#0f172a;--muted:#6b7280;--radius:12px}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--accent);background:var(--bg);padding:18px}
  .wrap{max-width:1000px;margin:0 auto}
  header{text-align:center;margin-bottom:18px}
  h1{margin:0;font-size:26px}
  p.lead{margin:8px 0;color:var(--muted)}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px}
  .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:0 8px 24px rgba(15,23,42,0.06)}
  .voting{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .profile{display:flex;flex-direction:column;align-items:center}
  .imgwrap{width:100%;border-radius:10px;overflow:hidden;background:#eee;aspect-ratio:3/4;position:relative}
  .imgwrap img{width:100%;height:100%;object-fit:cover;display:block}
  .btn{margin-top:10px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;background:#0f172a;color:#fff}
  .btn:disabled{opacity:0.45;cursor:not-allowed}
  .uploader{display:flex;flex-direction:column;gap:8px}
  input[type=file]{padding:6px}
  .muted{color:var(--muted)}
  .leaderboard-list{margin-top:10px;display:flex;flex-direction:column;gap:8px}
  .leader-item{display:flex;justify-content:space-between;align-items:center}
  .leader-left{display:flex;align-items:center;gap:8px}
  .thumb{width:44px;height:44px;border-radius:6px;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:18px;text-align:center;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Facemash — Daily Face-off</h1>
      <p class="lead">Two faces. One winner. Votes reset every 24 hours.</p>
    </header>

    <main class="grid">
      <section>
        <div class="card">
          <h3 style="margin-top:0">Today’s Match</h3>
          <div class="small muted">You can vote once per day. Winner is announced after 24 hours.</div>
          <div style="height:12px"></div>

          <div class="voting" id="votingArea">
            <div class="profile" id="leftCard"></div>
            <div class="profile" id="rightCard"></div>
          </div>
        </div>
      </section>

      <aside>
        <div class="card">
          <h4 style="margin-top:0">Add Person</h4>
          <div id="uploaderArea" class="uploader">
            <input id="nameInput" placeholder="Name (optional)" />
            <input id="fileInput" type="file" accept="image/*" />
            <button id="addBtn" class="btn">Add Person</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h4 style="margin-top:0">Current Score</h4>
          <div id="leaderboard" class="leaderboard-list"></div>
        </div>
      </aside>
    </main>

    <footer>
      Votes and results are saved only for 24 hours.
    </footer>
  </div>

<script>
(() => {
  const STORAGE_KEY = 'facemash_daily';
  const VOTE_KEY = 'facemash_daily_vote';
  const DAY_MS = 24*60*60*1000;

  const leftCard = document.getElementById('leftCard');
  const rightCard = document.getElementById('rightCard');
  const leaderboardEl = document.getElementById('leaderboard');
  const addBtn = document.getElementById('addBtn');
  const fileInput = document.getElementById('fileInput');
  const nameInput = document.getElementById('nameInput');

  let state = {
    dayStart: Date.now(),
    profiles: [],
    match: null // {leftId, rightId}
  };

  function load() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const parsed = JSON.parse(raw);
    if (Date.now() - parsed.dayStart > DAY_MS) return null; // expired
    return parsed;
  }

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function init() {
    const loaded = load();
    if (loaded) state = loaded;
    render();
  }

  function pickMatch() {
    if (state.profiles.length < 2) return;
    const i = Math.floor(Math.random()*state.profiles.length);
    let j = Math.floor(Math.random()*(state.profiles.length-1));
    if (j>=i) j++;
    state.match = { leftId: state.profiles[i].id, rightId: state.profiles[j].id };
    save();
  }

  function render() {
    if (!state.match && state.profiles.length>=2) pickMatch();
    if (!state.match) {
      leftCard.innerHTML = '<div class="small muted">Add at least 2 profiles.</div>';
      rightCard.innerHTML = '';
      leaderboardEl.innerHTML = '';
      return;
    }
    const left = state.profiles.find(p=>p.id===state.match.leftId);
    const right = state.profiles.find(p=>p.id===state.match.rightId);
    leftCard.innerHTML = makeProfile(left,true);
    rightCard.innerHTML = makeProfile(right,false);
    renderLeaderboard();
    bindVotes();
  }

  function makeProfile(p,isLeft) {
    return `
      <div class="imgwrap"><img src="${p.img}" alt=""></div>
      <div style="font-weight:700;margin-top:6px">${p.name||'—'}</div>
      <button class="btn" data-id="${p.id}">Vote</button>
    `;
  }

  function bindVotes() {
    const voted = JSON.parse(localStorage.getItem(VOTE_KEY)||'null');
    if (voted && Date.now()-voted.ts < DAY_MS) {
      document.querySelectorAll('.btn').forEach(b=>b.setAttribute('disabled',''));
      return;
    }
    document.querySelectorAll('.btn').forEach(b=>{
      b.addEventListener('click',()=>{
        const id = b.dataset.id;
        vote(id);
      });
    });
  }

  function vote(id) {
    const voted = JSON.parse(localStorage.getItem(VOTE_KEY)||'null');
    if (voted && Date.now()-voted.ts < DAY_MS) {
      alert("You already voted today.");
      return;
    }
    const prof = state.profiles.find(p=>p.id===id);
    prof.votes = (prof.votes||0)+1;
    save();
    localStorage.setItem(VOTE_KEY, JSON.stringify({ts:Date.now()}));
    render();
    alert("Thanks! Your vote was recorded.");
  }

  function renderLeaderboard() {
    const ranked = state.profiles.slice().sort((a,b)=>(b.votes||0)-(a.votes||0));
    leaderboardEl.innerHTML = ranked.map(p=>`
      <div class="leader-item">
        <div class="leader-left">
          <div class="thumb"><img src="${p.img}"></div>
          <div>${p.name||'—'}</div>
        </div>
        <div><b>${p.votes||0}</b> votes</div>
      </div>
    `).join('');
  }

  addBtn.addEventListener('click',()=>{
    const file = fileInput.files[0];
    if (!file) { alert("Select an image."); return; }
    const reader = new FileReader();
    reader.onload=()=>{
      const img = reader.result;
      const p = {id:Math.random().toString(36).slice(2,9),name:nameInput.value,img, votes:0};
      state.profiles.push(p);
      save();
      nameInput.value='';
      fileInput.value='';
      render();
    };
    reader.readAsDataURL(file);
  });

  init();
})();
</script>
</body>
</html>
